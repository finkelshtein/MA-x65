{
  "hash": "a04c74c9d29b8a982762e31fea1e6d87",
  "result": {
    "engine": "knitr",
    "markdown": "---\nformat: html\n---\n\n::: {.cell}\n\n:::\n\n\n# Proportional hazards models\n\n\n::: {.cell}\n\n:::\n\n\n::: {.callout-note icon=false}\n\n## 8.1 Covariates\n\n**Covariates** are characteristics\nof the participants of the experiment under consideration. For example, age, sex, type of treatment, level of medication, severity of symptoms and so on.\n\nMathematically, we represent the values of covariates as a vector $z$ with numerical components. Then e.g. the hazard rate $\\lambda_t$ (a.k.a the force of mortality) depend on $z$: $\\lambda_t=\\lambda(t,z)$.\n:::\n\n\n::: {.cell}\n\n:::\n\n\n::: {.callout-note icon=false}\n\n## 8.2 Proportional hazards models\n\nA common assumption about hazard is that the dependence on time and on the covariates can be factorized (i.e.\\ time and covariates are not \"twisted\"):\n$$\n\\lambda(t,z)=\\lambda_0(t)g(z).\n$$\nThe function $\\lambda_0(t)$ is called then the **baseline hazard**.\n\nThis is called a **proportional hazard model** (in short, a **PH model**). The reason for the name is that the proportion of of hazard rates for different covariates does not depend on time:\n$$\n\\frac{\\lambda(t,z_1)}{\\lambda(t,z_2)} = \\frac{g(z_1)}{g(z_2)}.\n$$\n:::\n\n\n::: {.cell}\n\n:::\n\n\n::: {.callout-note icon=false}\n\n## 8.3 A parametric PH model\n\n- A parametric PH model that uses the Gompertz distribution can be defined as follows.\n\n- We consider the hazard rate $\\lambda_t=bc^t$, $c>0$, that depends on covariates vector $z$:\n$$\n\\lambda(t,z)=b(z)c^t, \\qquad b(z):=\\exp(\\beta\\cdot z),\n$$\nwhere $\\beta$ is a vector of **regression coefficients**, and $\\beta\\cdot z$ denotes the scalar (a.k.a. inner) product.\n\n- Since both $c>0$ and $b(z)>0$, it is useful also to consider\n$$\n\\ln \\lambda(t,z)=t\\,\\ln c+\\beta\\cdot z.\n$$\n\n:::\n\n\n::: {.cell}\n\n:::\n\n\n::: {.callout-note icon=false}\n\n## 8.4 The Cox PH model\n\n- The Cox PH models proposes the following form of the hazard function\n$$\n\\lambda(t,z)=\\lambda_0(t)\\exp(\\beta\\cdot z).\n$$ {#eq-lin_regr}\n\n- $\\lambda_0(t)$ is the  *baseline hazard*, $\\beta$ is the vector of  *regression parameters*.\n\n\n\n- When $\\beta$ is known (or found), one can get the ratio of hazards for different covariates:\n$$\n\\frac{\\lambda(t,z_1)}{\\lambda(t,z_2)} = \\exp(\\beta\\cdot (z_1-z_2)).\n$$\nThis tells, in particular, how much larger is the force of mortality (a.k.a. hazard) for a covariate with respect to another one.\n\n- The traditional way to find (or rather, select) $\\beta$ is to maximize the **partial likelihood**. Namely, let deaths are recorded at moments of time $t_j$, $1\\leq j\\leq k$, and suppose first that **there is one death at each** $t_j$, i.e. $d_j=1$ for all $j$. Let $z_j$ be the covariates vector of the life died at time $t_j$. Let $R(t_j)$ be the set of all lives at risk to die prior to time $t_j$, $1\\leq j\\leq k$. The partial likelihood is defined then as follows:\n$$\nL(\\beta) = \\prod_{j=1}^k \\frac{\\exp(\\beta\\cdot z_j)}{\\sum\\limits_{i\\in R_{(t_j)}}\\exp(\\beta\\cdot z_i)}.\n$$\n\n- In the case when some $d_j>1$, the exact calculations are complicate, hence the following **Breslow's approximation** is in use:\n$$\nL(\\beta) = \\prod_{j=1}^k \\frac{\\exp(\\beta\\cdot z_j)}{\\Bigl(\\sum\\limits_{i\\in R_{(t_j)}}\\exp(\\beta\\cdot z_i)\\Bigr)^{d_j}}.\n$$\n\n:::\n\n\n::: {.cell}\n\n:::\n\n\n::: {.callout-tip icon=false}\n\n## 8.5 Remark\n\nIt is common to include all censored at time $t_j$ lives to $R(t_j)$, assuming that the censoring occurs just after the observed deaths.\n:::\n\n\n::: {.cell}\n\n:::\n\n\n::: {.callout-warning icon=false}\n\n## 8.6 Example \n\nA study is being conducted, using the Cox regression model, into how going to gym affects a patient's future lifetime after they had a serious heart attack.\nThe Cox model is considered with a parameter $\\beta\\in\\mathbb{R}$ and the covariate $z=1$ if the patient was a gym-visitor, and $z=0$ otherwise. The data about $9$ patients is available in the table. Patients are labelled as \"censored\" if they were still alive at the end of the study of if their death was not considered to be attributable to the decease. Time is measured in weeks.\n\n\n```{=latex}\n\\begin{tabular}{ |c|c|c|c| }\n\\hline\nPatient & Time to death & Gym & Censored\\\\ \\hline\n1 & 3 \t\t\t& No \t& Yes \\\\ \\hline\n2 & 5 \t\t\t& Yes \t& Yes \\\\ \\hline\n3 & 9 \t\t\t& Yes \t& No \\\\ \\hline\n4 & still alive\t& No \t& Yes \\\\ \\hline\n5 & 6 \t\t\t& No \t& No \\\\ \\hline\n6 & 7 \t\t\t& Yes \t& Yes \\\\ \\hline\n7 & 4 \t\t\t& Yes \t& No \\\\ \\hline\n8 & 8 \t\t\t& Yes \t& Yes \\\\ \\hline\n9 & 10 \t\t\t& Yes \t& Yes \\\\ \\hline\n\\end{tabular}\n```\n\n\nWe are going to find the partial likelihood function of $\\beta$ and the maximal partial likelihood estimator $\\beta^*$.\n\nSort the table by the time of death and highlight the non-censored deaths:\n\n\n```{=latex}\n\\begin{tabular}{ |c|c|c|c| }\n\\hline\nPatient & Time to death & Gym & Censored\\\\ \\hline\n1 & 3 \t& No \t& Yes \\\\ \\hline\n\\textbf{7} & \\textbf{4}\t\t\t& \\textbf{Yes} \t& \\textbf{No} \\\\ \\hline\n2 & 5 \t& Yes \t& Yes \\\\ \\hline\n\\textbf{5} & \\textbf{6} & \\textbf{No} \t& \\textbf{No} \\\\ \\hline\n6 & 7 \t\t\t& Yes \t& Yes \\\\ \\hline\n8 & 8 \t\t\t& Yes \t& Yes \\\\ \\hline\n\\textbf{3} & \\textbf{9} \t\t\t& \\textbf{Yes} \t& \\textbf{No} \\\\ \\hline\n9 & 10 \t\t\t& Yes \t& Yes \\\\ \\hline\n4 & still alive\t& No \t& Yes \\\\ \\hline\n\\end{tabular}\n```\n\n\nPatient 7 (a gym-visitor) died first after 4 weeks; before time 4 there are 6 gym-visitors and 2 non-gym-visitors. It gives the factor\n$$\n\tL_1(\\beta)=\\frac{e^{\\beta\\cdot1}}{6e^{\\beta\\cdot1}+2e^{\\beta\\cdot0}}=\\frac{e^\\beta}{6e^\\beta+2}.\n$$\n\t\t\nPatient 5 (a non-gym-visitor) died the second, at time 6; before time 6 remained 4 gym-visitors and 2 non-gym-visitors. It gives the factor\n$$\n\tL_2(\\beta)=\\frac{e^{\\beta\\cdot0}}{4e^{\\beta\\cdot1}+2e^{\\beta\\cdot0}}=\\frac{1}{4e^\\beta+2}.\n$$\n\nPatient 3 (a gym-visitor) died the last among non-censored, at time 9. By that time, there were 2 gym-visitors and 1 non-gym-visitor, it gives\n$$\n\tL_3(\\beta)=\\frac{e^{\\beta\\cdot1}}{2e^{\\beta\\cdot1} +e^{\\beta\\cdot0}}=\\frac{e^\\beta}{2e^\\beta +1}.\t\n$$\nTherefore,\n$$\n\\begin{aligned}\nL(\\beta) &= \tL_1(\\beta)L_2(\\beta)L_3(\\beta)=\\frac{e^\\beta}{6e^\\beta+2}\n\\frac{1}{4e^\\beta+2}\n\\frac{e^\\beta}{2e^\\beta +1}\\\\&=\\frac{e^{2\\beta}}{4(3e^\\beta+1)(2e^\\beta+1)^2}.\n\\end{aligned}\n$$\n\nThe point of maximum of $L(\\beta)$ is the same as for\n$$\n\\begin{aligned}\n\tl(\\beta):&= \\ln \\frac{e^{2\\beta}}{(3e^\\beta+1)(2e^\\beta+1)^2}\\\\& = 2\\beta - \\ln(3e^\\beta+1)- 2\\ln (2e^\\beta+1).\n\\end{aligned}\n$$\nWe have\n$$\n\\begin{aligned}\n\tl'(\\beta)&=2-\\frac{3e^\\beta}{3e^\\beta+1}-2\\cdot \\frac{2e^\\beta}{2e^\\beta+1}\\\\\n\t&= \\frac{2(3e^\\beta+1)(2e^\\beta+1)-3e^\\beta(2e^\\beta+1)-4e^\\beta(3e^\\beta+1)}{(3e^\\beta+1)(e^\\beta+1)^2},\n\\end{aligned}\n$$\nthus $l'(\\beta)=0$ implies\n$$\n\t-6e^{2\\beta}+3e^\\beta+2=0.\t\n$$\n\nTaking $x=e^\\beta>0$, we get\n$$\n\t6x^2-3x-2=0, \\quad x=\\frac{3+\\sqrt{57}}{12},\\quad\n\t\\beta^*=\\ln \\frac{3+\\sqrt{57}}{12}.\t\n$$\n\nCheck that this is indeed the point of maximum:\n$$\n\\begin{aligned}\n\tL''(\\beta) &=-3\\cdot \\frac{e^\\beta (3e^\\beta+1) -3e^\\beta\\cdot e^\\beta}{(3e^\\beta+1)^2}\\\\&\\quad -\t4\\cdot \\frac{e^\\beta (2e^\\beta+1) -2e^\\beta\\cdot e^\\beta}{(2e^\\beta+1)^2}\\\\\n\t&= -\\frac{3}{(3e^\\beta+1)^2}-\n\t\\frac{4}{(2e^\\beta+1)^2}<0\n\\end{aligned}\n$$\nfor all $\\beta$, in particular, for $\\beta=\\beta^*$. Hence $\\beta^*$ is the point of maximum.\n:::\n\n\n::: {.cell}\n\n:::\n\n\n::: {.callout-tip icon=false}\n\n## 8.7 Remark\n\nIf the choose the found value $\\beta=\\beta^*$ for the hazard rate ([-@eq-lin_regr]), then\n$$\n\\frac{\\lambda(t,z=1)}{\\lambda(t,z=0)}= e^{\\beta^*}=\\frac{3+\\sqrt{57}}{12}\\approx 0.879,\n$$\ni.e., according to the conducted study, the force of mortality for gym-visitor is approximately 88\\% of the force of mortality for non-gym-visitors (ignoring all other possible covariates: age, gender etc.)\n:::\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}